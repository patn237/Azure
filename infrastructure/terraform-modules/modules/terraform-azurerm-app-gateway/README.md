<!-- BEGIN_TF_DOCS -->

## Requirements

No requirements.

## Providers

| Name                                                         | Version |
| ------------------------------------------------------------ | ------- |
| <a name="provider_azurerm"></a> [azurerm](#provider_azurerm) | n/a     |

## Modules

No modules.

## Resources

| Name                                                                                                                                                      | Type     |
| --------------------------------------------------------------------------------------------------------------------------------------------------------- | -------- |
| [azurerm_application_gateway.appgw](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/application_gateway)                  | resource |
| [azurerm_key_vault_access_policy.kv_policy](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/key_vault_access_policy)      | resource |
| [azurerm_monitor_diagnostic_setting.agw_diag](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/monitor_diagnostic_setting) | resource |
| [azurerm_public_ip.agw_pip](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/public_ip)                                    | resource |
| [azurerm_role_assignment.kv_rbac_certificate](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)            | resource |
| [azurerm_role_assignment.kv_rbac_secret](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)                 | resource |
| [azurerm_user_assigned_identity.agw_uaid](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/user_assigned_identity)         | resource |

## Inputs

| Name                                                                                                                              | Description                                                                                                                                          | Type                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Default       | Required |
| --------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------- | :------: |
| <a name="input_agw_name"></a> [agw_name](#input_agw_name)                                                                         | The name of the Application Gateway Resource. Changing this forces a new resource to be created                                                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | n/a           |   yes    |
| <a name="input_agw_sku"></a> [agw_sku](#input_agw_sku)                                                                            | The SKU/Tier to use for the Application Gateway. Supported Values are Standard_v2 or WAF_v2                                                          | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | n/a           |   yes    |
| <a name="input_az_region"></a> [az_region](#input_az_region)                                                                      | The location where resources will be created                                                                                                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | n/a           |   yes    |
| <a name="input_backend_pools"></a> [backend_pools](#input_backend_pools)                                                          | List of maps including http listeners configuration and Keyvault Certificate Binding                                                                 | <pre>list(object({<br> backend_pool_name = string<br> ip_addresses = list(string)<br> fqdns = optional(list(string))<br> }))</pre>                                                                                                                                                                                                                                                                                                                                                                    | n/a           |   yes    |
| <a name="input_default_gateway_instance_count"></a> [default_gateway_instance_count](#input_default_gateway_instance_count)       | An override for the Application Gateway instance count when auto scaling is not in use                                                               | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `2`           |    no    |
| <a name="input_default_listener_request_timeout"></a> [default_listener_request_timeout](#input_default_listener_request_timeout) | An override for the request_timeout for https listeners                                                                                              | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `30`          |    no    |
| <a name="input_disabled_waf_rules"></a> [disabled_waf_rules](#input_disabled_waf_rules)                                           | The Web Application Firewall Mode. Possible values are Detection and Prevention.                                                                     | <pre>map(object({<br> rule_group_name = string<br> rules = optional(list(string))<br> }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                       | `null`        |    no    |
| <a name="input_domain_name_label"></a> [domain_name_label](#input_domain_name_label)                                              | an A DNS record is created for the public IP in the Microsoft Azure DNS system                                                                       | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `null`        |    no    |
| <a name="input_enable_autoscaling"></a> [enable_autoscaling](#input_enable_autoscaling)                                           | Toggle to enable autoscaling                                                                                                                         | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `false`       |    no    |
| <a name="input_enable_gateway_diagnostic_logs"></a> [enable_gateway_diagnostic_logs](#input_enable_gateway_diagnostic_logs)       | Toggle to enable or disable collection of the application gateway diagnostics logs                                                                   | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `false`       |    no    |
| <a name="input_gateway_subnet_id"></a> [gateway_subnet_id](#input_gateway_subnet_id)                                              | The ID of the Subnet delegated to App Gateway                                                                                                        | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | n/a           |   yes    |
| <a name="input_http_listeners"></a> [http_listeners](#input_http_listeners)                                                       | List of maps including http listeners configuration and Keyvault Certificate Binding                                                                 | <pre>list(object({<br> name = string<br> public_hostnames = list(string)<br> certificate_name = string<br> backend_pool_name = string<br> override_hostname_header_with_listener_domain = bool<br> backend_port = optional(string, "80")<br> probe_status_code = optional(list(string), ["200-399"])<br> health_check_path = optional(string, "/")<br> iis_site_hostname_override = optional(string)<br> priority_80 = optional(number, null)<br> priority_443 = optional(number, null)<br> }))</pre> | n/a           |   yes    |
| <a name="input_key_vault_auth_use_access_policy"></a> [key_vault_auth_use_access_policy](#input_key_vault_auth_use_access_policy) | Toggle to use access policy or RBAC for the keyvault access to the user assigned identity                                                            | `bool`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | n/a           |   yes    |
| <a name="input_key_vault_id"></a> [key_vault_id](#input_key_vault_id)                                                             | Specifies the id of the Key Vault resource                                                                                                           | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | n/a           |   yes    |
| <a name="input_key_vault_tenant_id"></a> [key_vault_tenant_id](#input_key_vault_tenant_id)                                        | The Azure Active Directory tenant ID that should be used for authenticating requests to the key vault.                                               | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | n/a           |   yes    |
| <a name="input_log_analytics_workspace_id"></a> [log_analytics_workspace_id](#input_log_analytics_workspace_id)                   | Log analytics workspace where diagnostics logs are collected                                                                                         | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `null`        |    no    |
| <a name="input_maximum_gateway_instance_count"></a> [maximum_gateway_instance_count](#input_maximum_gateway_instance_count)       | specifying max number of Application Gateway instances when autoscaling is in use. Maximum number is 125                                             | `number`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `125`         |    no    |
| <a name="input_rsg_name"></a> [rsg_name](#input_rsg_name)                                                                         | The name of the Resource Group for this deployment                                                                                                   | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | n/a           |   yes    |
| <a name="input_ssl_certificates"></a> [ssl_certificates](#input_ssl_certificates)                                                 | List of certificates which needs to be uploaded in 443 listners                                                                                      | <pre>list(object({<br> certificate_name = string<br> key_vault_secret_id = string<br> }))</pre>                                                                                                                                                                                                                                                                                                                                                                                                       | n/a           |   yes    |
| <a name="input_tags"></a> [tags](#input_tags)                                                                                     | Map of tags to be appended to the resource group on creation                                                                                         | `map(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | n/a           |   yes    |
| <a name="input_waf_mode"></a> [waf_mode](#input_waf_mode)                                                                         | The Web Application Firewall Mode. Possible values are Detection and Prevention.                                                                     | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `"Detection"` |    no    |
| <a name="input_waf_rule_set_type"></a> [waf_rule_set_type](#input_waf_rule_set_type)                                              | The Type of the Rule Set used for this Web Application Firewall. Possible values are OWASP, Microsoft_BotManagerRuleSet and Microsoft_DefaultRuleSet | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `"OWASP"`     |    no    |
| <a name="input_waf_rule_set_version"></a> [waf_rule_set_version](#input_waf_rule_set_version)                                     | The Version of the Rule Set used for this Web Application Firewall. Possible values are 0.1, 1.0, 2.1, 2.2.9, 3.0, 3.1 and 3.2.                      | `string`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | `"3.2"`       |    no    |
| <a name="input_zones"></a> [zones](#input_zones)                                                                                  | A collection containing the availability zone to allocate the resources being deployed                                                               | `list(string)`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `null`        |    no    |

## Outputs

| Name                                                              | Description                                      |
| ----------------------------------------------------------------- | ------------------------------------------------ |
| <a name="output_agw_id"></a> [agw_id](#output_agw_id)             | ID of the deployed application gateway           |
| <a name="output_agw_name"></a> [agw_name](#output_agw_name)       | Name of the deployed application gateway         |
| <a name="output_agw_pip"></a> [agw_pip](#output_agw_pip)          | IP address assigned to the application gateway   |
| <a name="output_agw_pip_id"></a> [agw_pip_id](#output_agw_pip_id) | ID of the deployed application gateway Public IP |

<!-- END_TF_DOCS -->
